# Admin test using imported blocks
test: Admin User Management
tags: [admin, users]
nav: /admin

include:
  - common/auth.yaml

vars:
  testUser: testuser_${timestamp}@example.com
  testRole: editor

do:
  # Ensure we're logged in as admin
  - use: ensure_logged_in

  # Navigate to user management
  - c: Users
  - wait: .user-list
  - store: {.user-count: initialCount}

  # Create new user
  - c: Add User
  - wait: .user-form
  - t: {#email: $testUser}
  - t: {#name: "Test User"}
  - select: {#role: $testRole}
  - c: Create User
  - wait: .success-message
  - ch: "User created successfully"

  # Verify user appears in list
  - wait: 2000
  - ch: $testUser
  - store: {.user-count: newCount}
  - note: "Verify count increased"

  # Edit user
  - c: $testUser
  - wait: .user-details
  - c: Edit
  - select: {#role: admin}
  - c: Save Changes
  - wait: .success-message

  # Verify role change
  - ch: admin

  # Delete user
  - c: Delete User
  - dialog: confirm
  - wait: .success-message
  - nch: $testUser

cleanup:
  - use: logout
