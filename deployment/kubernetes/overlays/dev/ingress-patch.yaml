apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: virtuoso-api-cli
  annotations:
    # No TLS in dev - use self-signed or none
    cert-manager.io/cluster-issuer: "self-signed"

    # Disable rate limiting in dev
    nginx.ingress.kubernetes.io/limit-connections: "0"
    nginx.ingress.kubernetes.io/limit-rps: "0"

    # Allow all CORS in dev
    nginx.ingress.kubernetes.io/cors-allow-origin: "*"
    nginx.ingress.kubernetes.io/cors-allow-credentials: "true"

    # Relaxed security headers for dev
    nginx.ingress.kubernetes.io/configuration-snippet: |
      more_set_headers "X-Environment: development";
      more_set_headers "X-Debug-Enabled: true";

    # Longer timeouts for debugging
    nginx.ingress.kubernetes.io/proxy-connect-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-send-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "300"
    nginx.ingress.kubernetes.io/proxy-body-size: "100m"

    # No SSL redirect in dev
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/force-ssl-redirect: "false"

    # Additional dev annotations
    nginx.ingress.kubernetes.io/enable-modsecurity: "false"
    nginx.ingress.kubernetes.io/enable-owasp-core-rules: "false"
spec:
  ingressClassName: nginx
  # No TLS or optional in dev
  tls: []
  rules:
  - host: api-dev.virtuoso.local  # Local dev domain
    http:
      paths:
      - path: /
        pathType: Prefix
        backend:
          service:
            name: virtuoso-api-cli
            port:
              number: 8000
  # Additional dev-only endpoints
  - host: api-dev.virtuoso.local
    http:
      paths:
      - path: /debug
        pathType: Prefix
        backend:
          service:
            name: virtuoso-api-cli
            port:
              number: 8000
