# API CLI Generator

**Created:** 2025-07-08  
**Purpose:** Generate intelligent CLI interfaces from OpenAPI specifications
**Status:** Production ready

## ğŸ¯ Overview

This project creates secure, intelligent CLI tools from OpenAPI specifications that:
- Handle complex multi-step workflows automatically
- Enforce business rules and validation
- Support batch operations from JSON/YAML files
- Provide multiple output formats (human, JSON, YAML, AI)
- Generate type-safe Go code from OpenAPI specs

## âš¡ Quick Start

```bash
# Generate CLI from OpenAPI spec
make generate

# Build the CLI binary
make build

# Run the CLI
./bin/api-cli --help

# Create structure from batch file
./bin/api-cli create-structure --file examples/test-structure.yaml
```

See [docs/guides/QUICK_START.md](docs/guides/QUICK_START.md) for detailed usage.

## ğŸ“š Documentation

- [docs/api-reference/](docs/api-reference/) - Complete command reference
- [docs/guides/](docs/guides/) - User guides and tutorials
- [docs/architecture/](docs/architecture/) - Architecture documentation
- [docs/development/](docs/development/) - Development guides
- [examples/](examples/) - Example structure files

## ğŸ”§ Configuration

The CLI supports flexible configuration through:

```yaml
# config/config.yaml
api:
  base_url: "https://api.example.com"
  headers:
    X-Client-ID: "api-cli-generator"
    X-Client-Name: "api-cli-generator"
  timeout: 30s
```

Configuration sources (in order of precedence):
- Command line flags
- Environment variables
- Configuration file (`config/config.yaml`)
- Default values

## ğŸ—ï¸ Architecture

```
OpenAPI Spec â†’ Code Generation â†’ Go CLI â†’ Multiple Deployment Targets
    â”‚               â”‚                â”‚
    â”‚               â”‚                â”œâ”€â”€ Local Binary
    â”‚               â”‚                â”œâ”€â”€ Docker Container
    â”‚               â”‚                â””â”€â”€ Web Service (optional)
    â”‚               â”‚
    â”‚               â””â”€â”€ oapi-codegen (generates client + types)
    â”‚
    â””â”€â”€ Version controlled, immutable source of truth
```

## âœ¨ Features

- **Type Safety**: Generated Go code ensures compile-time validation
- **Security**: Template injection prevention and parameter validation
- **Flexibility**: Multiple output formats and configuration options
- **Automation**: Batch operations from structured files
- **Documentation**: Auto-generated command documentation

## ğŸ“ Project Structure

```
api-cli-generator/
â”œâ”€â”€ README.md                # This file
â”œâ”€â”€ go.mod                   # Go module definition
â”œâ”€â”€ Makefile                 # Build automation
â”œâ”€â”€ specs/                   # OpenAPI specifications
â”‚   â””â”€â”€ api.yaml            # Your OpenAPI spec (from Postman)
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ cmd/                # CLI commands
â”‚   â”‚   â””â”€â”€ root.go         # Main command structure
â”‚   â”œâ”€â”€ api/                # Generated API client code
â”‚   â”‚   â”œâ”€â”€ client.gen.go   # Generated by oapi-codegen
â”‚   â”‚   â””â”€â”€ types.gen.go    # Generated types
â”‚   â”œâ”€â”€ client/             # Enhanced client wrapper
â”‚   â”‚   â””â”€â”€ client.go       # Adds retry, logging, etc.
â”‚   â””â”€â”€ templates/          # Request templates
â”‚       â””â”€â”€ templates.go    # Template management
â”œâ”€â”€ config/                 # Configuration files
â”‚   â””â”€â”€ config.yaml        # Default configuration
â”œâ”€â”€ scripts/               # Build and utility scripts
â”‚   â”œâ”€â”€ generate.sh        # Run code generation
â”‚   â””â”€â”€ validate-spec.sh   # Validate OpenAPI spec
â”œâ”€â”€ docs/                  # Documentation
â”‚   â””â”€â”€ usage.md          # CLI usage guide
â””â”€â”€ examples/             # Example usage
    â””â”€â”€ example-calls.sh  # Sample CLI invocations
```

## ğŸ› ï¸ Technology Stack

- **Language:** Go 1.21+
- **OpenAPI Tool:** oapi-codegen (v2)
- **CLI Framework:** Cobra + Viper
- **HTTP Client:** Generated client + go-resty
- **Templating:** Go text/template
- **Container:** Alpine-based Docker image

## ğŸš€ Getting Started

1. **Place your OpenAPI spec**
   ```bash
   cp your-api.yaml specs/api.yaml
   ```

2. **Generate code**
   ```bash
   make generate
   ```

3. **Build CLI**
   ```bash
   make build
   ```

4. **Configure your API**
   ```bash
   cp config/config.yaml.example config/config.yaml
   # Edit config.yaml with your API details
   ```

5. **Run locally**
   ```bash
   ./bin/api-cli --help
   ```

## ğŸ”’ Security Features

- **Immutable Definitions:** API shapes compiled into binary
- **Template Injection Prevention:** Strict parameter validation
- **No Dynamic Endpoints:** All paths fixed at build time
- **Minimal Attack Surface:** Only data values accepted at runtime

## ğŸ“‹ Workflow

### 1. Export from Postman
- Export collection as OpenAPI 3.0
- Place in `specs/api.yaml`
- Validate with `scripts/validate-spec.sh`

### 2. Generate Client Code
```bash
oapi-codegen -package api -generate types,client specs/api.yaml > src/api/client.gen.go
```

### 3. Build CLI Commands
- Each operation becomes a Cobra command
- Parameters mapped to CLI flags
- Templates for request bodies

### 4. Deploy
- **Local:** Single binary
- **Container:** `docker build -t api-cli .`
- **Service:** Thin HTTP wrapper around CLI

## ğŸ“‹ Implementation Status

### Core Features âœ…
- [x] OpenAPI spec parsing and code generation
- [x] Type-safe Go client generation
- [x] CLI command framework with Cobra
- [x] Configuration management with Viper
- [x] Multiple output formats (human, JSON, YAML, AI)
- [x] Batch operation support from YAML/JSON files
- [x] Docker containerization
- [x] Comprehensive documentation

### Advanced Features âœ…
- [x] Template-based request building
- [x] Error handling and retry logic
- [x] Dry-run mode for previewing operations
- [x] Structured logging and debugging
- [x] Flexible configuration hierarchy
- [x] Security validations and input sanitization

## ğŸ”— Dependencies

```go
// Key dependencies
github.com/deepmap/oapi-codegen/v2
github.com/spf13/cobra
github.com/spf13/viper
github.com/go-resty/resty/v2
```

## ğŸ“š References

- [oapi-codegen Documentation](https://github.com/deepmap/oapi-codegen)
- [Cobra CLI Guide](https://cobra.dev/)
- [OpenAPI 3.0 Specification](https://swagger.io/specification/)

## ğŸ“„ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## ğŸ¤ Contributing

Contributions are welcome! Please read [CONTRIBUTING.md](CONTRIBUTING.md) for details on our code of conduct and the process for submitting pull requests.

## ğŸ“Š Changelog

See [CHANGELOG.md](CHANGELOG.md) for a detailed history of changes to this project.
