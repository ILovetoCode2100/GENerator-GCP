# API CLI Generator

**Created:** 2025-07-08  
**Purpose:** Generate intelligent CLI interfaces from OpenAPI specifications
**Status:** Production ready

## 🎯 Overview

This project creates secure, intelligent CLI tools from OpenAPI specifications that:
- Handle complex multi-step workflows automatically
- Enforce business rules and validation
- Support batch operations from JSON/YAML files
- Provide multiple output formats (human, JSON, YAML, AI)
- Generate type-safe Go code from OpenAPI specs

## ⚡ Quick Start

```bash
# Generate CLI from OpenAPI spec
make generate

# Build the CLI binary
make build

# Run the CLI
./bin/api-cli --help

# Create structure from batch file
./bin/api-cli create-structure --file examples/test-structure.yaml
```

See [docs/guides/QUICK_START.md](docs/guides/QUICK_START.md) for detailed usage.

## 📚 Documentation

- [docs/api-reference/](docs/api-reference/) - Complete command reference
- [docs/guides/](docs/guides/) - User guides and tutorials
- [docs/architecture/](docs/architecture/) - Architecture documentation
- [docs/development/](docs/development/) - Development guides
- [examples/](examples/) - Example structure files

## 🔧 Configuration

The CLI supports flexible configuration through:

```yaml
# config/config.yaml
api:
  base_url: "https://api.example.com"
  headers:
    X-Client-ID: "api-cli-generator"
    X-Client-Name: "api-cli-generator"
  timeout: 30s
```

Configuration sources (in order of precedence):
- Command line flags
- Environment variables
- Configuration file (`config/config.yaml`)
- Default values

## 🏗️ Architecture

```
OpenAPI Spec → Code Generation → Go CLI → Multiple Deployment Targets
    │               │                │
    │               │                ├── Local Binary
    │               │                ├── Docker Container
    │               │                └── Web Service (optional)
    │               │
    │               └── oapi-codegen (generates client + types)
    │
    └── Version controlled, immutable source of truth
```

## ✨ Features

- **Type Safety**: Generated Go code ensures compile-time validation
- **Security**: Template injection prevention and parameter validation
- **Flexibility**: Multiple output formats and configuration options
- **Automation**: Batch operations from structured files
- **Documentation**: Auto-generated command documentation

## 📁 Project Structure

```
api-cli-generator/
├── README.md                # This file
├── go.mod                   # Go module definition
├── Makefile                 # Build automation
├── specs/                   # OpenAPI specifications
│   └── api.yaml            # Your OpenAPI spec (from Postman)
├── src/
│   ├── cmd/                # CLI commands
│   │   └── root.go         # Main command structure
│   ├── api/                # Generated API client code
│   │   ├── client.gen.go   # Generated by oapi-codegen
│   │   └── types.gen.go    # Generated types
│   ├── client/             # Enhanced client wrapper
│   │   └── client.go       # Adds retry, logging, etc.
│   └── templates/          # Request templates
│       └── templates.go    # Template management
├── config/                 # Configuration files
│   └── config.yaml        # Default configuration
├── scripts/               # Build and utility scripts
│   ├── generate.sh        # Run code generation
│   └── validate-spec.sh   # Validate OpenAPI spec
├── docs/                  # Documentation
│   └── usage.md          # CLI usage guide
└── examples/             # Example usage
    └── example-calls.sh  # Sample CLI invocations
```

## 🛠️ Technology Stack

- **Language:** Go 1.21+
- **OpenAPI Tool:** oapi-codegen (v2)
- **CLI Framework:** Cobra + Viper
- **HTTP Client:** Generated client + go-resty
- **Templating:** Go text/template
- **Container:** Alpine-based Docker image

## 🚀 Getting Started

1. **Place your OpenAPI spec**
   ```bash
   cp your-api.yaml specs/api.yaml
   ```

2. **Generate code**
   ```bash
   make generate
   ```

3. **Build CLI**
   ```bash
   make build
   ```

4. **Configure your API**
   ```bash
   cp config/config.yaml.example config/config.yaml
   # Edit config.yaml with your API details
   ```

5. **Run locally**
   ```bash
   ./bin/api-cli --help
   ```

## 🔒 Security Features

- **Immutable Definitions:** API shapes compiled into binary
- **Template Injection Prevention:** Strict parameter validation
- **No Dynamic Endpoints:** All paths fixed at build time
- **Minimal Attack Surface:** Only data values accepted at runtime

## 📋 Workflow

### 1. Export from Postman
- Export collection as OpenAPI 3.0
- Place in `specs/api.yaml`
- Validate with `scripts/validate-spec.sh`

### 2. Generate Client Code
```bash
oapi-codegen -package api -generate types,client specs/api.yaml > src/api/client.gen.go
```

### 3. Build CLI Commands
- Each operation becomes a Cobra command
- Parameters mapped to CLI flags
- Templates for request bodies

### 4. Deploy
- **Local:** Single binary
- **Container:** `docker build -t api-cli .`
- **Service:** Thin HTTP wrapper around CLI

## 📋 Implementation Status

### Core Features ✅
- [x] OpenAPI spec parsing and code generation
- [x] Type-safe Go client generation
- [x] CLI command framework with Cobra
- [x] Configuration management with Viper
- [x] Multiple output formats (human, JSON, YAML, AI)
- [x] Batch operation support from YAML/JSON files
- [x] Docker containerization
- [x] Comprehensive documentation

### Advanced Features ✅
- [x] Template-based request building
- [x] Error handling and retry logic
- [x] Dry-run mode for previewing operations
- [x] Structured logging and debugging
- [x] Flexible configuration hierarchy
- [x] Security validations and input sanitization

## 🔗 Dependencies

```go
// Key dependencies
github.com/deepmap/oapi-codegen/v2
github.com/spf13/cobra
github.com/spf13/viper
github.com/go-resty/resty/v2
```

## 📚 References

- [oapi-codegen Documentation](https://github.com/deepmap/oapi-codegen)
- [Cobra CLI Guide](https://cobra.dev/)
- [OpenAPI 3.0 Specification](https://swagger.io/specification/)

## 📄 License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## 🤝 Contributing

Contributions are welcome! Please read [CONTRIBUTING.md](CONTRIBUTING.md) for details on our code of conduct and the process for submitting pull requests.

## 📊 Changelog

See [CHANGELOG.md](CHANGELOG.md) for a detailed history of changes to this project.
